<p>SUPER MONS TESTING SITE!</p>
<p>
<button id="connect">Connect to MetaMask</button>
</p>
<p id="message">
</p>
<p id="mint_count">
</p>
<p id="buy">
</p>
 <script src="./bignumber.min.js"></script>
<script src="./web3.min.js"></script>
<script>
const ADDRESS = "0x17aBd4Cc1382397eC2B675f98621C3Ba809897DE";
const ABI = [{"inputs":[{"internalType":"address","name":"remilia_wallet","type":"address"},{"internalType":"address","name":"supermetalx_wallet","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"REMILIA_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"SUPERMETALX_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"wallet","type":"address"}],"name":"add_whitelist","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"free_mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"mint1","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"mint10","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"mint5","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"presale_mint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"baseURI","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"contractURI","type":"string"}],"name":"setContractURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw_remilia","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw_supermetalx","outputs":[],"stateMutability":"nonpayable","type":"function"}];

//connect to MetaMask
document.getElementById("connect").onclick = function(){
	this.disabled = true;
	const msg = document.getElementById("message");
	if(!window.ethereum || !window.ethereum.isMetaMask){
		msg.innerHTML = "MetaMask was not detected. Please <a href='https://metamask.io/'>Install MetaMask</a> to continue."; 
		return;
	}
	
	if(window.ethereum.isConnected()){
		start();
		return;
	}
	
	ethereum.on("connect", start);
	msg.innerHTML = "Connecting to MetaMask....";

}
//begin basic eth operations
var wallet = null;
async function start(){

	const msg = document.getElementById("message");
	msg.innerHTML = "Connected to MetaMask.";
	
	window.ethereum.request({	method: "eth_requestAccounts" })
		.then( function( accounts ){
			msg.innerHTML = "Connected to MetaMask. Wallet ID: " + accounts[0];
			wallet = accounts[0];
			buy_init();
		})
		.catch( function(error){
			if(error.code == 4001){
				msg.innerHTML = "MetaMask declined request.";
			}
			else{
				msg.innerHTML = error.message;
			}
		});

	const web3 = new Web3(window.ethereum);
	if(!web3){
		msg.innerHTML = "web3.js errror.";
		return;
	}
	
	contract = new web3.eth.Contract(ABI, ADDRESS);
	if(!contract){
		msg.innerHTML = "could not read contract at " + ADDRESS;
		return;
	}
	
	total_supply = await contract.methods.totalSupply().call();
	
	document.getElementById("mint_count").innerHTML = "NFTs minted: " + total_supply + "/" + 777;
}

function buy_init(){
		
	document.getElementById("buy").innerHTML = 
		"<p><button id=\"transferOwnership\">transferOwnership</button></p>"	
		"<p><button id=\"free\">Claim Free NFT</button></p>" +
		"<p><button id=\"presale\">Buy Presale NFT</button></p>" +
		"<p><button id=\"mint1\">Mint 1</button></p>" +
		"<p><button id=\"mint3\">Mint 3</button></p>" +
		"<p><button id=\"mint5\">Mint 5</button></p>"+
		"<p><button id=\"wdr\">Withdraw remilia share</button></p>"+ 
		"<p><button id=\"wdx\">Withdraw SMX share</button></p>"	
	;
	document.getElementById("free").onclick = mint_free;
	document.getElementById("presale").onclick = mint_presale;
	document.getElementById("mint1").onclick = function(){	
		mint(1);
	}
	document.getElementById("mint3").onclick = function(){	
		mint(2);
	}
	document.getElementById("mint5").onclick = function(){	
		mint(3);
	}
	document.getElementById("wdr").onclick = wdr;
	document.getElementById("wdx").onclick = wdx;
}

async function to(){

	if(!wallet){
		return;
	}

	const web3 = new Web3(window.ethereum);
	contract = new web3.eth.Contract(ABI, ADDRESS);

	const gas_price = await web3.eth.getGasPrice();
	var gas = 0;
	try{
		gas = await contract.methods.transferOwnership("0xE4790DD79c334e3f848904975272ec17f9F70366").estimateGas({ gasPrice: gas_price , from: wallet, value: 0 });
	}
	catch{
		console.log("estg failed");
		gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
	}
	
	console.log("gas: "+ gas);
	console.log("price: 0");
	
	contract.methods.transferOwnership("0xE4790DD79c334e3f848904975272ec17f9F70366").send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: 0,   });
}



async function wdr(){

	if(!wallet){
		return;
	}

	const web3 = new Web3(window.ethereum);
	contract = new web3.eth.Contract(ABI, ADDRESS);

	const gas_price = await web3.eth.getGasPrice();
	var gas = 0;
	try{
		gas = await contract.methods.withdraw_remilia().estimateGas({ gasPrice: gas_price , from: wallet, value: 0 });
	}
	catch{
		console.log("estg failed");
		gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
	}
	
	console.log("gas: "+ gas);
	console.log("price: 0");
	
	contract.methods.withdraw_remilia().send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: 0,   });
}

async function wdx(){

	if(!wallet){
		return;
	}

	const web3 = new Web3(window.ethereum);
	contract = new web3.eth.Contract(ABI, ADDRESS);

	const gas_price = await web3.eth.getGasPrice();
	var gas = 0;
	try{
		gas = await contract.methods.withdraw_supermetalx().estimateGas({ gasPrice: gas_price , from: wallet, value: 0 });
	}
	catch{
		console.log("estg failed");
		gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
	}
	
	console.log("gas: "+ gas);
	console.log("price: 0");
	
	contract.methods.withdraw_supermetalx().send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: 0,   });
}


async function mint_free(){

	if(!wallet){
		return;
	}

	const web3 = new Web3(window.ethereum);
	contract = new web3.eth.Contract(ABI, ADDRESS);

	const gas_price = await web3.eth.getGasPrice();
	var gas = 0;
	try{
		gas = await contract.methods.free_mint().estimateGas({ gasPrice: gas_price , from: wallet, value: 0 });
	}
	catch{
		console.log("estg failed");
		gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
	}
	
	console.log("gas: "+ gas);
	console.log("price: 0");
	
	contract.methods.free_mint().send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: 0,   });
}

async function mint_presale(){

	if(!wallet){
		return;
	}

	const web3 = new Web3(window.ethereum);
	contract = new web3.eth.Contract(ABI, ADDRESS);
	const price = BigNumber(0.0009).multipliedBy("1e18").toNumber();
	
	const gas_price = await web3.eth.getGasPrice();
	var gas = 0;
	try{
		gas = await contract.methods.presale_mint().estimateGas({ gasPrice: gas_price , from: wallet, value: price });
	}
	catch{
		console.log("estg failed");
		gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
	}
	
	console.log("gas: "+ gas);
	console.log("price: "+ price);
	
	contract.methods.presale_mint().send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: price,   });
}

async function mint(x){

	if(!wallet){
		return;
	}

	const web3 = new Web3(window.ethereum);
	contract = new web3.eth.Contract(ABI, ADDRESS);
	
	
	const gas_price = await web3.eth.getGasPrice();
	var gas = 0;
	
	switch(x){
	case 1:
		price = BigNumber(0.001).multipliedBy("1e18").toNumber();
		try{
			gas = await contract.methods.mint1().estimateGas({ gasPrice: gas_price , from: wallet, value: price });
		}
		catch{
			console.log("estg failed");
			gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
		}
		console.log("gas: "+ gas);
		console.log("price: "+ price);
		contract.methods.mint1().send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: price,   });
		return;
	case 2:
		price = BigNumber(0.005).multipliedBy("1e18").toNumber();
		try{
			gas = await contract.methods.mint5().estimateGas({ gasPrice: gas_price , from: wallet, value: price });
		}
		catch{
			console.log("estg failed");
			gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
		}
		console.log("gas: "+ gas);
		console.log("price: "+ price);
		contract.methods.mint5().send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: price,   });
		return;
	case 3:
		price = BigNumber(0.01).multipliedBy("1e18").toNumber();
		try{
			gas = await contract.methods.mint10().estimateGas({ gasPrice: gas_price , from: wallet, value: price });
		}
		catch{
			console.log("estg failed");
			gas = Math.floor(BigNumber(0.015).multipliedBy("1e18").dividedBy(gas_price).toNumber());
		}
		console.log("gas: "+ gas);
		console.log("price: "+ price);
		contract.methods.mint10().send({ gas: gas, from: wallet, gasPrice: gas_price.toString(), value: price,   });
		return;
	}
	
	
}
</script>
